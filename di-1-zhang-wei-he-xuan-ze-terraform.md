# 第1章 为何选择Terraform

代码在您的计算机上运行的代时候，代码刚刚测试通过的时候，当有人让您去部署代码的时候，这些情况下都意味着软件并未交付。 只有当您将软件交付给用户的时候，软件才算正式发布。 软件交付包括您为客户提供代码交付所需的所有工作，例如在生产服务器上运行该代码，使代码能够适应中断和流量峰值，以及保护代码免受攻击者攻击。 在深入了解Terraform的细节之前，有必要回顾下Terraform在哪些方面适合软件交付。 

在本章中，我将深入研究以下主题： 

•DevOps的崛起

 •基础设施即代码

 •基础设施即代码的好处

 •Terraform如何运作

 •Terraform与其他基础设施即代码工具的比较

## DevOps的崛起 

在不远的过去，如果你想建立一家软件公司，那你将不得不管理很多硬件。您可以设置机柜和机架，使用服务器加载它们，连接接线，安装冷却，构建冗余电源系统等等。你需要有一个团队，通常称为“运维团队“，致力于管理这些硬件，以及一个独立的团队，通常称为“开发团队“，专门用于编写软件。 

典型的开发团队执行应用程序构建，并将构建完的程序移交给运维团队。然后由运维团队决定如何部署和运行该应用程序。大多数情况下，这一环节是手动完成的。在某种程度上，这是不可避免的，因为大部分工作都与物理连接硬件（例如货架服务器，连接网络电缆）有关。但即使运维团队所做的工作，例如安装应用程序及其依赖项，通常也是通过在服务器上手动执行命令来完成的。 

这种情况短期内很有效，但随着公司的发展，你最终会遇到问题。由于发布是手动完成的，随着服务器数量的增加，发布变得缓慢，痛苦和不可预测。 运维团队偶尔会出错，所以你最终会得到“雪花服务器“，即其中一台服务器的配置与其他服务器配置不同，结果导致出错的情况增加。开发人员可能会说：“它可以在我的机器上运行！”，但是，停机频次和停机时间可能会大幅增加。 

运维团队在每次发布后的凌晨3点都对他们的寻呼机感到厌倦，将发布节奏减少到每周一次。然后每个月一次。然后每六个月一次。在两年一次的发布前几周，团队开始尝试将所有项目合并在一起，导致合并冲突的混乱。没人能稳定发布分支。团队之间开始互相指责，该公司陷入停顿。

如今，这一现象已经明显改观。许多公司不再管理自己的数据中心，而是转向云计算，利用Amazon Web Services（AWS），Azure和Google Cloud等服务。许多运维团队不是大量投资硬件，而是使用Chef，Puppet，Terraform和Docker等工具将所有时间花在软件上。许多系统管理员不是编写服务器和插入网络电缆，而是编写代码。 

因此，开发和运维团队都将大部分时间花在软件上，两个团队之间的区别正在变得模糊。虽然让一个独立的开发团队负责应用程序代码，而让运维团队负责代码交付可能依然可行，但很明显开发和运维需要更紧密地协同工作。这便是DevOps一词的来源。 

DevOps不是团队、职称或特定技术的名称。相反，它是一组流程，想法和技术。每个人对DevOps的定义都略有不同，但对于本书，我将使用以下内容： 

####          DevOps的目标是使软件交付更加高效。 

您可以持续集成代码并始终将其保持在可部署状态，而无需再经历历时好几天的代码合并。您可以每天部署代码数十次，甚至可以在每次提交后部署代码，而不是每月部署一次代码。您可以通过构建弹性，自我修复系统，并使用监控和警报来捕获无法自动解决的问题，从而避免出现持续故障和停机的状况。 

采用DevOps实践的公司所需要的成果是令人震惊。例如，Nordstrom发现，在将DevOps实践应用于他们的组织后，他们能够将每月交付的功能数量增加一倍，将缺陷减少50％，缩短交付周期（从产生想法到在生产环境运行代码）减少60％，并将生产环境故障数量减少60％～90％。在HP的LaserJet固件部门开始采用DevOps实践之后，开发人员开发新功能所花费的时间从5％增加到40％，总体开发成本降低了40％。 Etsy使用DevOps实践之后，一改原本部署压力大，频次低，故障率高的情况，实现了每天25～50次的持续部署。

DevOps有四个核心价值观：文化，自动化，测量和共享（可以缩写为CAMS）。本书并不是对DevOps的全面概述，因此我将只关注其中一个值：自动化。 自动化的目标是尽可能多地自动化交付软件。这意味着您是通过代码，而不是通过单击网页或手动执行shell命令来管理您的基础设施，这就是通常所说的基础设施即代码的含义。



##  基础设施即代码

 

## 基础设施即代码的好处



##  Terraform如何运作

 

## Terraform与其他基础设施即代码工具的比较

基础设施即代码（IAC）很完美，但如何选择IAC工具的过程却是件令人头疼的工作。许多IAC工具功能上存在着重叠。其中部分工具是开源的，而另外一些工具则提供商业支持。除非你自己知道如何选择，否则究竟应该用什么标准来选择IAC工具呢？

更令人难以理解的是，关于这些工具间的比较，大多数情况下只列出了每个工具的一般属性，并且似乎每种工具都能完成你需要完成的工作。虽然这在技术上是正确的，但实际上并没有太大帮助。这有点像告诉一个编程新手，你可以同样成功地用PHP，C或汇编建立一个网站 - 一个技术上真实的陈述，但是却省略了大量有助于作出正确决定的信息。

接下来，我将对最流行的配置管理和编排工具：Terraform，Chef，Pup pet，Ansible，SaltStack，CloudFormation和OpenStack Heat等进行详细地比较。目标是要说明为什么我们选择Terraform作为IAC工具。以及从某种意义上说，这也是为什么我要写这本书的目的。如同其他技术决策一样，选取IAC工具涉及到权衡和优先级，虽然您的特定优先级可能与我的不同，但我希望通过分享这个思考过程，来帮助您做出自己的决定。 

以下在决策过程中，需要考虑的主要权衡因素：

配置管理与编排

可变基础架构与不可变基础架构

程序语言与声明语言

客户端/服务器断架构与仅客户端架构

大型社区与小型社区

成熟与前沿技术

